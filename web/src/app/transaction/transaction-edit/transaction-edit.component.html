<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <mat-toolbar color="primary">
    <button mat-icon-button class="example-icon" aria-label="Example icon-button with menu icon">
      <mat-icon>menu</mat-icon>
    </button>
    <span>My App</span>
    <span class="spacer"></span>
    <button mat-icon-button class="example-icon favorite-icon" aria-label="Example icon-button with heart icon">
      <mat-icon>save</mat-icon>
    </button>
  </mat-toolbar>
  <mat-tab-group>
    <mat-tab label="Részletek">
      <div class="transaction-edit__tab">
        <div>
          <app-datetime-input formControlName="issuedAt">
          </app-datetime-input>
        </div>
        <div class="transaction-edit__amount">
          <app-amount-input formControlName="amount" [currency]="form.value.account?.currency">
          </app-amount-input>
        </div>
        <div class="transaction-edit__account">
          <app-autocomplete-input [items]="accounts | async" label="Számla" displayNameProperty="name" idProperty="accountId"
            formControlName="account"></app-autocomplete-input>
        </div>
        <mat-slide-toggle color="primary" formControlName="isTransfer">Átvitel másik számlára</mat-slide-toggle>
        <div class="transaction-edit__account" *ngIf="form.value.isTransfer">
          <app-autocomplete-input [items]="transferAccounts | async"
            label="Átvitel {{form.value.amount >= 0 ? 'innen' : 'ide'}}" displayNameProperty="name" idProperty="accountId"
            formControlName="transferAccount"></app-autocomplete-input>
        </div>
        <div class="transaction-edit__category" *ngIf="!form.value.isTransfer && form.value.splits.length === 0">
          <app-autocomplete-input [items]="categories | async" label="Kategória" displayNameProperty="fullName" idProperty="categoryId"
            formControlName="category"></app-autocomplete-input>
        </div>
        <div class="transaction-edit__project" *ngIf="!form.value.isTransfer && form.value.splits.length === 0">
          <app-autocomplete-input [items]="projects | async" label="Projekt" displayNameProperty="name" idProperty="projectId"
            formControlName="project"></app-autocomplete-input>
        </div>
        <div class="transaction-edit__recipient" *ngIf="!form.value.isTransfer">
          <app-autocomplete-input [items]="recipients | async" label="Partner" displayNameProperty="name" idProperty="recipientId"
            formControlName="recipient"></app-autocomplete-input>
        </div>
        <div class="transaction-edit__description">
          <app-clearable-input formControlName="description" label="Megjegyzés">
          </app-clearable-input>
        </div>
      </div>
    </mat-tab>
    <mat-tab label="Bontás">
      <div class="transaction-edit__tab" formArrayName="splits">
        <p class="transaction-edit__split-amount">
          Összesen: {{form.value.amount}} {{form.value.account?.currency}}
          <button mat-mini-fab color="primary" (click)="addSplit()">
            <mat-icon>add</mat-icon>
          </button>
        </p>
        <p class="transaction-edit__split_diff" *ngIf="splitsDiff !== 0">
          Hiányzó összeg: {{ splitsDiff}} {{form.value.account?.currency}}
        </p>
        <div *ngFor="let split of splits.controls; index as i" [formGroup]="split"
          class="mat-elevation-z2 transaction-edit-split-item">
          <div class="transaction-edit-split-item__details">
            <div class="transaction-edit-split-item__amount">
              <app-amount-input formControlName="amount" [currency]="form.value.account?.currency">
              </app-amount-input>
            </div>
            <div class="transaction-edit-split-item__category">
              <app-autocomplete-input [items]="categories | async" label="Kategória" displayNameProperty="fullName" idProperty="categoryId"
                formControlName="category"></app-autocomplete-input>
            </div>
            <div class="transaction-edit-split-item__project">
              <app-autocomplete-input [items]="projects | async" label="Projekt" displayNameProperty="name" idProperty="projectId"
                formControlName="project"></app-autocomplete-input>
            </div>
            <div class="transaction-edit-split-item__description">
              <app-clearable-input formControlName="description" label="Megjegyzés">
              </app-clearable-input>
            </div>
          </div>
          <div class="transaction-edit-split-item__delete">
            <button mat-icon-button color="warn" class="transaction-edit-split-item" (click)="deleteSplit(i)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</form>

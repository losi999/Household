<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <app-toolbar title="Tranzakció">
    <button mat-icon-button type="button" *ngIf="transactionId" (click)="deleteTransaction()">
      <mat-icon>delete</mat-icon>
    </button>
    <button mat-icon-button>
      <mat-icon>save</mat-icon>
    </button>
  </app-toolbar>
  <mat-tab-group>
    <mat-tab label="Részletek">
      <div class="transaction-edit__tab">
        <div>
          <app-datetime-input formControlName="issuedAt">
          </app-datetime-input>
        </div>
        <div class="transaction-edit__amount">
          <app-amount-input formControlName="amount" [currency]="account.currency">
          </app-amount-input>
        </div>
        <div class="transaction-edit__account">
          <app-autocomplete-input [items]="accounts" label="Számla" displayNameProperty="name"
            formControlName="account"></app-autocomplete-input>
        </div>
        <mat-slide-toggle color="primary" formControlName="isTransfer">Átvitel másik számlára</mat-slide-toggle>
        <div class="transaction-edit__account" *ngIf="isTransfer">
          <app-autocomplete-input [items]="transferAccounts" label="Átvitel {{amount >= 0 ? 'innen' : 'ide'}}"
            displayNameProperty="name" formControlName="transferAccount"></app-autocomplete-input>
        </div>
        <div class="transaction-edit__category" *ngIf="!isTransfer && splits.length === 0">
          <app-autocomplete-input [items]="categories" label="Kategória" displayNameProperty="fullName"
            formControlName="category"></app-autocomplete-input>
        </div>
        <div class="transaction-edit__project" *ngIf="!isTransfer && splits.length === 0">
          <app-autocomplete-input [items]="projects" label="Projekt" displayNameProperty="name"
            formControlName="project"></app-autocomplete-input>
        </div>
        <div class="transaction-edit__recipient" *ngIf="!isTransfer">
          <app-autocomplete-input [items]="recipients" label="Partner" displayNameProperty="name"
            formControlName="recipient"></app-autocomplete-input>
        </div>
        <div class="transaction-edit__description">
          <app-clearable-input formControlName="description" label="Megjegyzés">
          </app-clearable-input>
        </div>
      </div>
    </mat-tab>
    <mat-tab label="Bontás">
      <div class="transaction-edit__tab" formArrayName="splits">
        <p class="transaction-edit__split-amount">
          Összesen: {{amount}} {{account.currency}}
          <button mat-mini-fab color="primary" (click)="addSplit()" type="button">
            <mat-icon>add</mat-icon>
          </button>
        </p>
        <p class="transaction-edit__split_diff" *ngIf="splitsDiff !== 0">
          Hiányzó összeg: {{ splitsDiff}} {{account.currency}}
        </p>
        <div *ngFor="let split of splitsArray.controls; index as i" [formGroup]="split"
          class="mat-elevation-z2 transaction-edit-split-item">
          <div class="transaction-edit-split-item__details">
            <div class="transaction-edit-split-item__amount">
              <app-amount-input formControlName="amount" [currency]="account.currency">
              </app-amount-input>
            </div>
            <div class="transaction-edit-split-item__category">
              <app-autocomplete-input [items]="categories" label="Kategória" displayNameProperty="fullName"
                formControlName="category"></app-autocomplete-input>
            </div>
            <div class="transaction-edit-split-item__project">
              <app-autocomplete-input [items]="projects" label="Projekt" displayNameProperty="name"
                formControlName="project"></app-autocomplete-input>
            </div>
            <div class="transaction-edit-split-item__description">
              <app-clearable-input formControlName="description" label="Megjegyzés">
              </app-clearable-input>
            </div>
          </div>
          <div class="transaction-edit-split-item__delete">
            <button mat-icon-button color="warn" class="transaction-edit-split-item" (click)="deleteSplit(i)"
              type="button">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</form>
